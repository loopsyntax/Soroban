/*
   Date: Feb 2024
   Author: Fred Kyung-jin Rezeau <fred@litemint.com>
   MIT License
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,f){a.raw=f;return a};$jscomp.arrayIteratorImpl=function(a){var f=0;return function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var f="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(f)return f.call(a);if("number"==typeof a.length)return $jscomp.arrayIterator(a);throw Error(String(a)+" is not an iterable or ArrayLike");};$jscomp.arrayFromIterator=function(a){for(var f,g=[];!(f=a.next()).done;)g.push(f.value);return g};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;
$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,g){if(a==Array.prototype||a==Object.prototype)return a;a[f]=g.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<a.length;++f){var g=a[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,f,g){if(!g||null!=a){g=$jscomp.propertyToPolyfillSymbol[f];if(null==g)return a[f];g=a[g];return void 0!==g?g:a[f]}};$jscomp.polyfill=function(a,f,g,h){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,f,g,h):$jscomp.polyfillUnisolated(a,f,g,h))};
$jscomp.polyfillUnisolated=function(a,f,g,h){g=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var l=a[h];if(!(l in g))return;g=g[l]}a=a[a.length-1];h=g[a];f=f(h);f!=h&&null!=f&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(a,f,g,h){var l=a.split(".");a=1===l.length;h=l[0];h=!a&&h in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var y=0;y<l.length-1;y++){var x=l[y];if(!(x in h))return;h=h[x]}l=l[l.length-1];g=$jscomp.IS_SYMBOL_NATIVE&&"es6"===g?h[l]:null;f=f(g);null!=f&&(a?$jscomp.defineProperty($jscomp.polyfills,l,{configurable:!0,writable:!0,value:f}):f!==g&&(void 0===$jscomp.propertyToPolyfillSymbol[l]&&(g=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[l]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(l):$jscomp.POLYFILL_PREFIX+g+"$"+l),$jscomp.defineProperty(h,$jscomp.propertyToPolyfillSymbol[l],{configurable:!0,writable:!0,value:f})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},f={};try{return f.__proto__=a,f.a}catch(g){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,f){a.__proto__=f;if(a.__proto__!==f)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype["return"]=function(a){this.abruptCompletion_={"return":a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,f){this.nextAddress=f;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,f){var g=$jscomp.makeIterator(a),h=g.next();$jscomp.generator.ensureIteratorResultIsObject_(h);if(h.done)this.yieldResult=h.value,this.nextAddress=f;else return this.yieldAllIterator_=g,this.yield(h.value,f)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,f){this.catchAddress_=a;void 0!=f&&(this.finallyAddress_=f)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,f){this.nextAddress=a;this.catchAddress_=f||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,f,g){g?this.finallyContexts_[g]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=f||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,f){var g=this.finallyContexts_.splice(f||0)[0];if(g=this.abruptCompletion_=this.abruptCompletion_||g){if(g.isException)return this.jumpToErrorHandler_();void 0!=g.jumpTo&&this.finallyAddress_<g.jumpTo?(this.nextAddress=g.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var f in a)this.properties_.push(f);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var f=this.context_.yieldAllIterator_;if(f)return this.yieldAllStep_("return"in f?f["return"]:function(g){return{value:g,done:!0}},a,this.context_["return"]);this.context_["return"](a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,f,g){try{var h=a.call(this.context_.yieldAllIterator_,f);$jscomp.generator.ensureIteratorResultIsObject_(h);if(!h.done)return this.context_.stop_(),h;var l=h.value}catch(y){return this.context_.yieldAllIterator_=null,this.context_.throw_(y),this.nextStep_()}this.context_.yieldAllIterator_=null;g.call(this.context_,l);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(f){this.context_.yieldResult=void 0,this.context_.throw_(f)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a["return"],done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(f){return a.next_(f)};this["throw"]=function(f){return a.throw_(f)};this["return"]=function(f){return a.return_(f)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,f){var g=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(f));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(g,a.prototype);return g};
$jscomp.asyncExecutePromiseGenerator=function(a){function f(h){return a.next(h)}function g(h){return a["throw"](h)}return new Promise(function(h,l){function y(x){x.done?h(x.value):Promise.resolve(x.value).then(f,g).then(y,l)}y(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
(function(a){function f(y){return new Promise(function(x){return setTimeout(x,y)})}var g,h,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(y){g=new StellarSdk.SorobanRpc.Server("https://bridge.litemint.com/soroban/rpc",{allowHttp:!0});l=h=!1;a.insertCoin=function(x){var J,G,H,b,t,B,u,C,K,w,L,M,z,I,E;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:if(h)return r["return"]();h=!0;l=!1;if(a.localMode){a.table={balls:[],pockets:[]};for(J=0;5>J;J+=
1)a.table.balls.push({x:5*Math.random()+2.5,y:6,vx:0,vy:0}),a.table.pockets.push({x:5*Math.random()+2.5,y:2});r.jumpTo(2);break}a.table=null;r.setCatchFinallyBlocks(3);if(G=StellarSdk.StrKey.isValidEd25519SecretSeed(x)?StellarSdk.Keypair.fromSecret(x):null){H=G.publicKey();r.jumpTo(5);break}return r.yield(freighterApi.getPublicKey(),6);case 6:H=r.yieldResult;case 5:return b=H,r.yield(g.getAccount(b),7);case 7:return t=r.yieldResult,B=new StellarSdk.Contract("CAX3OHJQBIY47DM7DJ4AIGNJERD2CSLEN6OMCL7A722IZIJJR45VBSUT"),
u=(new StellarSdk.TransactionBuilder(t,{fee:1E6,networkPassphrase:"Public Global Stellar Network ; September 2015"})).addOperation(B.call("insertcoin",(new StellarSdk.Address(b)).toScVal())).setTimeout(300).addMemo(StellarSdk.Memo.text("Soroban Snooker")).build(),r.yield(g.prepareTransaction(u),8);case 8:u=r.yieldResult;if(null==(C=G)?0:C.canSign()){u.sign(G);r.jumpTo(9);break}return r.yield(freighterApi.signTransaction(u.toEnvelope().toXDR("base64"),{networkPassphrase:"Public Global Stellar Network ; September 2015"}),
10);case 10:K=r.yieldResult,u=new StellarSdk.Transaction(K,"Public Global Stellar Network ; September 2015");case 9:return r.yield(g.sendTransaction(u),11);case 11:w=r.yieldResult,L=w.hash;case 12:if("PENDING"!==w.status&&"NOT_FOUND"!==w.status){"SUCCESS"===w.status?(M=StellarSdk.xdr.TransactionMeta.fromXDR(w.resultMetaXdr.toXDR().toString("base64"),"base64"),z=M.v3().sorobanMeta().returnValue(),I=StellarSdk.scValToNative(z),a.table={balls:I.balls.map(function(F){return{x:Number(F[0])/1E3,y:Number(F[1])/
1E3,vx:0,vy:0}}),pockets:I.pockets.map(function(F){return{x:Number(F[0])/1E3,y:Number(F[1])/1E3}})}):(console.error(JSON.stringify(w)),l=!0);r.leaveTryBlock(2);break}return r.yield(f(1500),15);case 15:return r.yield(g.getTransaction(L),16);case 16:w=r.yieldResult;r.jumpTo(12);break;case 3:E=r.enterCatchBlock(),console.error(E),l=!0;case 2:h=!1,r.jumpToEnd()}})};a.play=function(x,J,G){var H,b,t,B,u,C,K,w,L,M,z,I,E,r,F;return $jscomp.asyncExecutePromiseGeneratorProgram(function(p){switch(p.nextAddress){case 1:if(h)return p["return"]();
h=!0;l=!1;a.score=0;if(a.localMode){H=[0,21,39,66,102,147];a.score=H[G];p.jumpTo(2);break}p.setCatchFinallyBlocks(3);if(b=StellarSdk.StrKey.isValidEd25519SecretSeed(x)?StellarSdk.Keypair.fromSecret(x):null){t=b.publicKey();p.jumpTo(5);break}return p.yield(freighterApi.getPublicKey(),6);case 6:t=p.yieldResult;case 5:return B=t,u=StellarSdk.nativeToScVal(J,{type:"i128"}),p.yield(g.getAccount(B),7);case 7:return C=p.yieldResult,K=new StellarSdk.Contract("CAX3OHJQBIY47DM7DJ4AIGNJERD2CSLEN6OMCL7A722IZIJJR45VBSUT"),
w=(new StellarSdk.TransactionBuilder(C,{fee:1E5,networkPassphrase:"Public Global Stellar Network ; September 2015"})).addOperation(K.call("play",(new StellarSdk.Address(B)).toScVal(),u)).setTimeout(300).addMemo(StellarSdk.Memo.text("Soroban Snooker")).build(),p.yield(g.prepareTransaction(w),8);case 8:w=p.yieldResult;if(null==(L=b)?0:L.canSign()){w.sign(b);p.jumpTo(9);break}return p.yield(freighterApi.signTransaction(w.toEnvelope().toXDR("base64"),{networkPassphrase:"Public Global Stellar Network ; September 2015"}),
10);case 10:M=p.yieldResult,w=new StellarSdk.Transaction(M,"Public Global Stellar Network ; September 2015");case 9:return p.yield(g.sendTransaction(w),11);case 11:z=p.yieldResult,I=z.hash;case 12:if("PENDING"!==z.status&&"NOT_FOUND"!==z.status){"SUCCESS"===z.status?(E=StellarSdk.xdr.TransactionMeta.fromXDR(z.resultMetaXdr.toXDR().toString("base64"),"base64"),r=E.v3().sorobanMeta().returnValue(),a.score=StellarSdk.scValToNative(r)):(console.error(JSON.stringify(z)),l=!0);p.leaveTryBlock(2);break}return p.yield(new Promise(function(N){return setTimeout(N,
1E3)}),15);case 15:return p.yield(g.getTransaction(I),16);case 16:z=p.yieldResult;p.jumpTo(12);break;case 3:F=p.enterCatchBlock(),console.error(F),l=!0;case 2:h=!1,p.jumpToEnd()}})};a.busy=function(){return h};a.errored=function(){return l};a.networkPassphrase=function(){return"Public Global Stellar Network ; September 2015"};a.testSecret=function(){return"S---ECRET"};a.clearError=function(){l=!1};y.jumpToEnd()})})(window.SnookerContract=window.SnookerContract||{});
(function(a){function f(n){n.isDown&&(b.translate(n.x+.5*n.width,n.y+.5*n.height),b.scale(.95,.95),b.translate(-(n.x+.5*n.width),-(n.y+.5*n.height)))}function g(n,c,d,e,k,q,A){b.beginPath();b.moveTo(d+A,e);b.arcTo(d+k,e,d+k,e+q,A);b.arcTo(d+k,e+q,d,e+q,A);b.arcTo(d,e+q,d,e,A);b.arcTo(d,e,d+k,e,A);b.closePath();b.fillStyle="rgba("+n+", "+c+")";b.fill()}function h(n,c,d,e,k,q,A){b.save();b.translate(d,e);b.scale(G*k,G*k);b.translate(-d,-e);b.textAlign=A||"center";q&&(b.font="bold 40px Roboto");b.fillStyle=
c;b.fillText(n,d,e);b.restore()}function l(n){n.preventDefault();L()}function y(n){n.preventDefault();w("touchmove"===n.type?{x:n.touches[0].clientX,y:n.touches[0].clientY}:{x:n.clientX,y:n.clientY})}function x(n){n.preventDefault();K("touchstart"===n.type?{x:n.touches[0].clientX,y:n.touches[0].clientY}:{x:n.clientX,y:n.clientY})}function J(){b.setTransform(1,0,0,1,0,0);b.clearRect(0,0,t.width,t.height);b.textAlign="center";b.textBaseline="middle";b.font="40px Roboto";M(H);z();window.requestAnimationFrame(J)}
var G,H,b,t,B,u,C,K,w,L,M,z,I,E,r,F,p,N,P,O,D;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){G=.0078125;H=.02;u=B=0;C=[];a.StrikeStatus={Paused:0,Running:1,Success:2,Failed:3};a.StageScreen={Intro:0,Menu:1,Score:2};a.WalletStatus={NotInstalled:0,InvalidNetwork:1,Connected:2};a.StrikeSolver=function(){if(!(this instanceof a.StrikeSolver))throw Error("Constructor called as a function.");this.reset()};a.StrikeSolver.prototype.reset=function(c,d,e){c=void 0===c?{x:5,y:10,vx:0,vy:0}:c;
d=void 0===d?{x:2.5,y:6,vx:0,vy:0}:d;e=void 0===e?{x:5,y:3.8}:e;this.balls=[c,d];this.pocket=e;this.curIter=500;this.status=a.StrikeStatus.Paused;this.completed=!1;this.lastDist=Number.MAX_SAFE_INTEGER;this.pocketed=!1};a.StrikeSolver.prototype.update=function(c){if(this.status!==a.StrikeStatus.Paused){for(var d=$jscomp.makeIterator(this.balls),e=d.next();!e.done;e=d.next())e=e.value,e.x+=e.vx*c,e.y+=e.vy*c;this.status!==a.StrikeStatus.Running&&this.status!==a.StrikeStatus.Success||this.applyCollisions()}};
a.StrikeSolver.prototype.strike=function(c,d,e,k){this.status=a.StrikeStatus.Running;var q=O(e,k,c,d);this.balls[0].vx=6*((1.5<q?e+(c-e)/q*1.5:c)-e);this.balls[0].vy=6*((1.5<q?k+(d-k)/q*1.5:d)-k)};a.StrikeSolver.prototype.applyCollisions=function(){var c=this;if(!this.completed)if(this.status===a.StrikeStatus.Success){var d=this.pocket.x-this.balls[1].x,e=this.pocket.y-this.balls[1].y;d=d*d+e*e;d>this.lastDist&&(this.completed=this.pocketed=!0);this.lastDist=d}else if(!this.balls[0].collided&&this.curIter||
this.status!==a.StrikeStatus.Running){e=this.balls[1].x-this.balls[0].x;var k=this.balls[1].y-this.balls[0].y;d=e*e+k*k;if(1>d){C.push([Math.round(1E3*this.balls[0].x),Math.round(1E3*this.balls[0].y),Math.round(1E3*this.balls[0].vx),Math.round(1E3*this.balls[0].vy)]);if(0!==d){var q=1/d;e*=q;k*=q;q=-this.balls[0].vx*e-this.balls[0].vy*k;this.balls[0].vx+=q*e;this.balls[0].vy+=q*k;this.balls[1].vx-=q*e;this.balls[1].vy-=q*k}this.balls[0].collided=!0}d>this.lastDist&&(this.curIter=1);this.lastDist=
d;this.status===a.StrikeStatus.Running&&(--this.curIter,this.curIter||this.balls[0].collided||C.push([0,0,0,0]))}else d=this.balls[1].x*this.balls[1].vx*Number.MAX_SAFE_INTEGER-this.balls[1].x,e=this.balls[1].y*this.balls[1].vy*Number.MAX_SAFE_INTEGER-this.balls[1].y,k=d*(this.balls[1].y-this.pocket.y)-e*(this.balls[1].x-this.pocket.x),this.status=0<=.5625*(d*d+e*e)-k*k&&this.balls[0].collided?a.StrikeStatus.Success:a.StrikeStatus.Failed,a.StrikeStatus.Success!==this.status?setTimeout(function(){c.completed=
!0},1E3):this.lastDist=Number.MAX_SAFE_INTEGER};a.StrikeSolver.prototype.getEntities=function(){return[].concat($jscomp.arrayFromIterable(this.balls),[this.pocket])};a.initialize=function(){var c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){switch(e.nextAddress){case 1:a.unitCamera=new LitemintEngine.Camera;a.primaryCamera=new LitemintEngine.Camera;a.secondaryCamera=new LitemintEngine.Camera;a.hudCamera=new LitemintEngine.Camera;t=document.getElementById("canvas");b=t.getContext("2d");
t.addEventListener("mousedown",x);t.addEventListener("mousemove",y);t.addEventListener("mouseup",l);t.addEventListener("touchstart",x);t.addEventListener("touchmove",y);t.addEventListener("touchend",l);a.resize();a.strikeSolver=new a.StrikeSolver;a.stageScreen=a.StageScreen.Intro;J();if(c=!freighterApi){e.jumpTo(2);break}return e.yield(freighterApi.isConnected(),3);case 3:c=!e.yieldResult;case 2:if(c){a.walletStatus=a.WalletStatus.NotInstalled;e.jumpTo(0);break}return e.yield(freighterApi.getNetworkDetails(),
5);case 5:d=e.yieldResult,d.networkPassphrase!==SnookerContract.networkPassphrase()?a.walletStatus=a.WalletStatus.InvalidNetwork:a.walletStatus=a.WalletStatus.Connected,e.jumpToEnd()}})};a.resize=function(){if(t){var c=window.innerWidth,d=window.innerHeight;a.scene={x:0,y:0,height:15,width:10,margin:1,isLandscape:c>=d};t.width=a.scene.isLandscape?2048:1152;t.height=a.scene.isLandscape?2048*d/c:1152*d/c;t.style.width=c+"px";t.style.height=d+"px";a.ratio={x:c/t.width,y:d/t.height};a.unitCamera.sx=128;
a.unitCamera.sy=128;a.unitCamera.update();a.size=p({x:t.width,y:t.height});a.unit=Math.max(a.size.x,a.size.y)*(a.scene.isLandscape?.018:.022);a.practiceBtn={x:.5*a.size.x-8.2*a.unit,y:.5*a.size.y-a.unit,width:8*a.unit,height:4*a.unit};a.insertCoinBtn={x:.5*a.size.x+.2*a.unit,y:.5*a.size.y-a.unit,width:8*a.unit,height:4*a.unit};a.playDemoBtn={x:.5*a.size.x-4.05*a.unit,y:.5*a.size.y+9.5*a.unit,width:8.1*a.unit,height:2.7*a.unit};a.closeBtn={x:.5*a.size.x-2.025*a.unit,y:.5*a.size.y+9.5*a.unit,width:4.05*
a.unit,height:2.7*a.unit};a.githubBtn={x:a.size.x-8.1*a.unit,y:0,width:8.1*a.unit,height:5.4*a.unit};a.litemintBtn={x:a.size.x-8*a.unit,y:a.size.y-3.5*a.unit,width:6.9*a.unit,height:2.3*a.unit}}};K=function(c){SnookerContract.busy()||SnookerContract.errored()||a.strikeSolver.status!==a.StrikeStatus.Paused||(a.hudPoint=p(c),a.hudPoint.isDown=!0,c={x:a.hudPoint.x/a.ratio.x,y:a.hudPoint.y/a.ratio.y},D(c,a.githubBtn)?a.githubBtn.isDown=!0:D(c,a.litemintBtn)?a.litemintBtn.isDown=!0:a.stageScreen===a.StageScreen.Score?
D(c,a.closeBtn)&&(a.closeBtn.isDown=!0):a.stageScreen===a.StageScreen.Intro?D(c,a.playDemoBtn)&&(a.playDemoBtn.isDown=!0):SnookerContract.table||(D(c,a.insertCoinBtn)?a.insertCoinBtn.isDown=!0:D(c,a.practiceBtn)&&(a.practiceBtn.isDown=!0)))};w=function(c){if(!SnookerContract.busy()&&!SnookerContract.errored()){var d,e=null==(d=a.hudPoint)?void 0:d.isDown;a.hudPoint=p(c);a.hudPoint.isDown=e}};L=function(){var c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:if(SnookerContract.busy())return k["return"]();
SnookerContract.errored()&&SnookerContract.clearError();if(null==(c=a.hudPoint)||!c.isDown){k.jumpTo(0);break}d={x:a.hudPoint.x/a.ratio.x,y:a.hudPoint.y/a.ratio.y};a.hudPoint=null;if(D(d,a.githubBtn)&&a.githubBtn.isDown){window.open("https://github.com/FredericRezeau/soroban-snooker","_blank");k.jumpTo(3);break}if(D(d,a.litemintBtn)&&a.litemintBtn.isDown){window.open("https://litemint.com","_blank");k.jumpTo(3);break}if(a.stageScreen===a.StageScreen.Score){D(d,a.closeBtn)&&(a.stageScreen=a.StageScreen.Intro);
k.jumpTo(3);break}if(a.stageScreen===a.StageScreen.Intro){D(d,a.playDemoBtn)&&a.playDemoBtn.isDown&&(a.stageScreen=a.StageScreen.Menu,a.menuAnimTime=1);k.jumpTo(3);break}if(SnookerContract.table){e=p(N(a.strikeSolver.getEntities()[0]));a.strikeSolver.strike(e.x,e.y,d.x,d.y);k.jumpTo(3);break}if(D(d,a.insertCoinBtn)&&a.insertCoinBtn.isDown){if(a.walletStatus!==a.WalletStatus.Connected){k.jumpTo(3);break}SnookerContract.localMode=!1;return k.yield(SnookerContract.insertCoin(SnookerContract.testSecret()),
13)}if(!D(d,a.practiceBtn)||!a.practiceBtn.isDown){k.jumpTo(3);break}SnookerContract.localMode=!0;return k.yield(SnookerContract.insertCoin(),11);case 11:SnookerContract.table&&(u=B=0,C=[],a.strikeSolver.reset({x:5,y:10,vx:0,vy:0,color:"red"},SnookerContract.table.balls[u],SnookerContract.table.pockets[u]));k.jumpTo(3);break;case 13:SnookerContract.table&&(u=B=0,C=[],a.strikeSolver.reset({x:5,y:10,vx:0,vy:0,color:"red"},SnookerContract.table.balls[u],SnookerContract.table.pockets[u]));case 3:a.closeBtn.isDown=
!1,a.playDemoBtn.isDown=!1,a.litemintBtn.isDown=!1,a.githubBtn.isDown=!1,a.practiceBtn.isDown=!1,a.insertCoinBtn.isDown=!1,k.jumpToEnd()}})};M=function(c){var d,e,k,q;return $jscomp.asyncExecutePromiseGeneratorProgram(function(A){d=function(){var v=a.strikeSolver.getEntities();v.length&&(a.strikePos={x:v[0].x,y:v[0].y},a.strikeAngle=0,a.strikeDist=0)};a.sceneAngle=a.sceneAngle?(a.sceneAngle+Math.PI*c*(SnookerContract.table?a.sceneAngle<Math.PI?-2:2:.02))%(2*Math.PI):.03;SnookerContract.table&&a.sceneAngle<
.2*Math.PI&&(a.sceneAngle=0);SnookerContract.table&&a.strikeSolver.pocketed?(a.pocketedScale+=.3*c,a.pocketedScale=Math.min(.1,a.pocketedScale)):a.pocketedScale=0;a.menuAnimTime?(a.menuAnimTime-=2.5*c,0>a.menuAnimTime&&(a.menuAnimTime=0)):a.menuAnimTime=0;P(c);a.strikeSolver.update(c);e=function(v,m){m.target||(m.target=!0,m.initialDistance=Math.sqrt(Math.pow(m.x-v.x,2)+Math.pow(m.y-v.y,2)),m.angle=0,m.iterations=0,m.angleIncrement=2*Math.PI*c*Math.sqrt(Math.pow(v.vx,2)+Math.pow(v.vy,2))/(3*m.initialDistance),
m.approachAngle=Math.atan2(m.y-v.y,m.x-v.x));m.iterations+=1;if(m.angle<2*Math.PI*m.initialDistance*2){var Q=m.y+(m.initialDistance-.1*m.angle)*Math.sin(m.approachAngle-m.angle);v.x=m.x+(m.initialDistance-.1*m.angle)*Math.cos(m.approachAngle-m.angle);v.y=Q;v.x+=v.vx*c*.5;v.y+=v.vy*c*.5;m.angle+=m.angleIncrement;return!1}v.x=m.x;v.y=m.y;return 50<m.iterations};k=a.strikeSolver.getEntities();!a.strikeSolver.completed||a.strikeSolver.pocketed&&!e(k[1],k[2])||(u+=1,a.StrikeStatus.Success===a.strikeSolver.status&&
(B+=1),(null==(q=SnookerContract.table)?0:q.balls)&&u<SnookerContract.table.balls.length?a.strikeSolver.reset({x:5,y:10,vx:0,vy:0},SnookerContract.table.balls[u],SnookerContract.table.pockets[u]):(SnookerContract.table=null,a.strikeSolver.reset(),SnookerContract.play(SnookerContract.testSecret(),C,B),a.stageScreen=a.StageScreen.Score,C=[],B=0),d());a.strikePos||d();A.jumpToEnd()})};z=function(){b.save();I();r();F();b.restore()};I=function(){b.save();b.setTransform.apply(b,a.unitCamera.matrix);b.transform.apply(b,
a.hudCamera.matrix);b.fillStyle="#147dbe";b.fillRect(0,0,a.size.x,a.size.y);b.restore()};E=function(c,d){b.save();var e=.9;switch(d){case "cueball":b.drawImage(a.sprites,128,0,384,384,c.x-e,c.y-e,2*e,2*e);break;case "colorball":e*=1-a.pocketedScale;b.drawImage(a.sprites,128,384,384,384,c.x-e,c.y-e,2*e,2*e);break;case "pocket":e=1.2,b.drawImage(a.sprites,512,0,384,384,c.x-e,c.y-e,2*e,2*e),SnookerContract.table||E(c,"colorball")}b.restore()};r=function(){b.save();b.setTransform.apply(b,a.unitCamera.matrix);
b.transform.apply(b,a.primaryCamera.matrix);b.transform.apply(b,a.secondaryCamera.matrix);b.translate(-a.secondaryCamera.x,-a.secondaryCamera.y);b.translate(a.scene.x+.5*a.scene.width,a.scene.y+.5*a.scene.height);b.rotate(a.sceneAngle);b.translate(-(a.scene.x+.5*a.scene.width),-(a.scene.y+.5*a.scene.height));b.save();b.translate(a.scene.x+.5*a.scene.width,a.scene.y+.5*a.scene.height);b.scale(5,3);b.translate(-(a.scene.x+.5*a.scene.width),-(a.scene.y+.5*a.scene.height));for(var c=b.createLinearGradient(0,
0,0,a.scene.height),d=$jscomp.makeIterator([{position:0,color:"#074b7a"},{position:.5,color:"#147dbe"},{position:1,color:"#074b7a"}]),e=d.next();!e.done;e=d.next())e=e.value,c.addColorStop(e.position,e.color);b.fillStyle=c;b.fillRect(a.scene.x,a.scene.y,a.scene.width,a.scene.height);if(!a.noise)for(a.noise=[],c=0;c<a.scene.height;c+=1)for(a.noise[c]=[],d=0;d<a.scene.width;d+=1)a.noise[c].push(20*Math.random()-10);for(c=0;c<a.scene.height;c+=1)for(d=0;d<a.scene.width;d+=1)b.fillStyle="rgba(255, 255, 255, "+
Math.abs(a.noise[c][d])/80+")",b.fillRect(d,c,1,1);c=b.createLinearGradient(0,.6*a.scene.height,0,a.scene.height);c.addColorStop(0,"rgba(235, 160, 255, 0.02)");c.addColorStop(1,"rgba(235, 160, 255, 0.02)");b.fillStyle=c;b.fillRect(0,.6*a.scene.height,a.scene.width,.4*a.scene.height);b.restore();b.save();b.beginPath();b.moveTo(-a.scene.width,.64*a.scene.height);b.lineTo(2*a.scene.width,.64*a.scene.height);b.strokeStyle="rgba(255, 255, 255, 0.5)";b.lineWidth=.015;b.stroke();c=.25*a.scene.width;b.beginPath();
b.arc(.5*a.scene.width,.8*a.scene.height-c,c,0,Math.PI,!1);b.stroke();b.restore();c=a.strikeSolver.getEntities();if(c.length){E(c[2],"pocket");E(c[1],"colorball");E(c[0],"cueball");b.save();if(a.strikeSolver.status===a.StrikeStatus.Paused){var k;(null==(k=a.hudPoint)?0:k.isDown)&&SnookerContract.table&&(k=p(N(c[0])),d=a.hudPoint.x/a.ratio.x,e=a.hudPoint.y/a.ratio.y,a.strikeAngle=Math.atan2(e-k.y,d-k.x)-.5*Math.PI,a.strikeDist=Math.min(1.5,O(d,e,k.x,k.y)),a.strikePos={x:c[0].x,y:c[0].y})}b.translate(a.strikePos.x,
a.strikePos.y);b.rotate(a.strikeAngle);b.translate(-a.strikePos.x,-a.strikePos.y);a.strikeSolver.status===a.StrikeStatus.Paused&&(b.save(),b.translate(c[0].x,c[0].y),b.rotate(1.25*Math.PI),b.translate(-c[0].x,-c[0].y),b.beginPath(),b.setLineDash([.05,.05]),b.moveTo(c[0].x,c[0].y),b.lineTo(c[0].x+10,c[0].y+10),b.strokeStyle="#fff",b.lineWidth=.02,b.stroke(),b.restore());b.translate(0,a.strikeSolver.status!==a.StrikeStatus.Paused?-.5:a.strikeDist);b.drawImage(a.sprites,0,0,128,1024,a.strikePos.x-1,
a.strikePos.y,2,16);b.restore()}b.restore()};F=function(){b.save();b.setTransform.apply(b,a.unitCamera.matrix);b.transform.apply(b,a.hudCamera.matrix);SnookerContract.table?(b.drawImage(a.sprites,512,512,768,256,.015*a.size.x,a.size.y-3.5*a.unit,8*a.unit,2.675*a.unit),h("TAP + HOLD TO ADJUST POWER AND DIRECTION","rgb(255,255,255)",.5*a.size.x,a.size.y-3.7*a.unit,.5),h("RELEASE TO SHOOT","rgb(255,255,255)",.5*a.size.x,a.size.y-2.7*a.unit,.5),h("BALL "+(u+1)+"/5","rgb(255,255,255)",a.unit,a.unit,.9,
!0,"start")):(a.stageScreen===a.StageScreen.Menu?(b.save(),b.translate(0,a.menuAnimTime*a.size.y),f(a.practiceBtn),b.drawImage(a.sprites,0,1024,512,256,a.practiceBtn.x,a.practiceBtn.y,a.practiceBtn.width,a.practiceBtn.height),b.restore(),b.save(),b.translate(0,a.menuAnimTime*a.size.y),f(a.insertCoinBtn),a.walletStatus!==a.WalletStatus.Connected&&(h("Need Freighter wallet","rgb(130,240,255)",a.insertCoinBtn.x+.5*a.insertCoinBtn.width,a.insertCoinBtn.y+4.7*a.unit,.65),h("on Mainnet to play","rgb(130,240,255)",
a.insertCoinBtn.x+.5*a.insertCoinBtn.width,a.insertCoinBtn.y+5.7*a.unit,.65),b.globalAlpha=.3),b.drawImage(a.sprites,512,1024,512,256,a.insertCoinBtn.x,a.insertCoinBtn.y,a.insertCoinBtn.width,a.insertCoinBtn.height),b.restore()):SnookerContract.busy()||(g("0, 0, 0",.5,.5*a.size.x-9*a.unit,.5*a.size.y-4.5*a.unit,18*a.unit,14*a.unit,.5*a.unit),a.stageScreen===a.StageScreen.Intro?(h("SMART CONTRACT FEATURES","rgb(255,70,211)",.5*a.size.x,.5*a.size.y-3.2*a.unit,.75,!0),h("In-app purchase & NFT reward",
"rgb(255,255,255)",.5*a.size.x,.5*a.size.y-1*a.unit,.75),h("Gameplay validation","rgb(255,255,255)",.5*a.size.x,.5*a.size.y+.5*a.unit,.75),h("(pool physics, time-based...)","rgb(255,255,255)",.5*a.size.x,.5*a.size.y+1.5*a.unit,.75),h("Admin and auth","rgb(255,255,255)",.5*a.size.x,.5*a.size.y+3*a.unit,.75),h("(game assets, withdrawals...)","rgb(255,255,255)",.5*a.size.x,.5*a.size.y+4*a.unit,.75),h("Soroban Storage","rgb(255,255,255)",.5*a.size.x,.5*a.size.y+5.5*a.unit,.75),h("(temporary, persistent, instance)",
"rgb(255,255,255)",.5*a.size.x,.5*a.size.y+6.5*a.unit,.75),h("Custom types and more...","rgb(255,255,255)",.5*a.size.x,.5*a.size.y+8*a.unit,.75),b.save(),f(a.playDemoBtn),b.drawImage(a.sprites,128,768,768,256,a.playDemoBtn.x,a.playDemoBtn.y,a.playDemoBtn.width,a.playDemoBtn.height)):(h("YOUR SCORE","rgb(130,240,255)",.5*a.size.x,.5*a.size.y-1*a.unit,1.2,!0),h(""+SnookerContract.score,"rgb(255,255,255)",.5*a.size.x,.5*a.size.y+3*a.unit,4,!0),b.save(),f(a.closeBtn),b.drawImage(a.sprites,896,768,384,
256,a.closeBtn.x,a.closeBtn.y,a.closeBtn.width,a.closeBtn.height)),b.restore()),b.drawImage(a.sprites,512,512,768,256,.5*a.size.x-8*a.unit,.5*a.size.y-11.5*a.unit,16*a.unit,5.35*a.unit),h("Showcasing web3 gaming with Soroban on Stellar","rgb(255,255,255)",.5*a.size.x,.5*a.size.y-5.8*a.unit,.8));b.save();f(a.litemintBtn);b.drawImage(a.sprites,512,384,384,128,a.litemintBtn.x,a.litemintBtn.y,a.litemintBtn.width,a.litemintBtn.height);b.restore();b.drawImage(a.sprites,896,0,384,256,a.githubBtn.x,a.githubBtn.y,
a.githubBtn.width,a.githubBtn.height);var c=b,d=c.drawImage,e=a.sprites,k=a.size.x-7.5*a.unit,q=a.unit;var A=(Date.now()+1E3)/1E3;A=.02*(Math.abs(A%4-2)-1)+1-Math.abs(A%2-1).toFixed(2);d.call(c,e,896,256,384,256,k,q*(3.5+.5*A),7.5*a.unit,5*a.unit);SnookerContract.busy()&&(b.fillStyle="rgba(0, 0, 0, 0.6)",b.fillRect(0,0,a.size.x,a.size.y),h("CALLING SMART CONTRACT, PLEASE WAIT...","rgb(255,255,255)",.5*a.size.x,.7*a.size.y,1,!0));SnookerContract.errored()&&(b.fillStyle="rgba(0, 0, 0, 0.7)",b.fillRect(0,
0,a.size.x,a.size.y),g("255, 0, 0",.5,.5*a.size.x-9*a.unit,.5*a.size.y-2.5*a.unit,18*a.unit,4*a.unit,.5*a.unit),h("AN ERROR OCCURED","rgb(255,255,255)",.5*a.size.x,.5*a.size.y-a.unit,.75,!0),h("Try again or check console.","rgb(255,255,255)",.5*a.size.x,.5*a.size.y+.2*a.unit,.75,!1));b.restore()};p=function(c){var d=new LitemintEngine.Camera;d.multiply(a.unitCamera);d.multiply(a.hudCamera);return d.screenToCamera(c.x,c.y)};N=function(c){var d=new LitemintEngine.Camera;d.multiply(a.unitCamera);d.multiply(a.primaryCamera);
d.multiply(a.secondaryCamera);d.translate(-a.secondaryCamera.x,-a.secondaryCamera.y);return d.cameraToScreen(c.x,c.y)};P=function(c){var d=new LitemintEngine.Camera;d.multiply(a.unitCamera);d=d.screenToCamera(t.width,t.height);a.cameraTarget={x:a.scene.x+.5*a.scene.width,y:a.scene.y+.5*a.scene.height,zoom:Math.min(d.y/(a.scene.height+a.scene.margin),d.x/(a.scene.width+a.scene.margin))};a.cameraTarget.zoom*=SnookerContract.table&&!a.sceneAngle?1.1:1.6;var e=a.primaryCamera.x,k=a.primaryCamera.y;a.primaryCamera.x=
0;a.primaryCamera.y=0;a.primaryCamera.update();a.primaryCamera.tx=d.x/2-a.cameraTarget.x;a.primaryCamera.ty=d.y/2-a.cameraTarget.y;var q=O(e,k,a.primaryCamera.tx,a.primaryCamera.ty);.001<Math.abs(q)?(e+=c*q*6*(a.primaryCamera.tx-e)/q,k+=c*q*6*(a.primaryCamera.ty-k)/q):(e=a.primaryCamera.tx,k=a.primaryCamera.ty);a.primaryCamera.x=e;a.primaryCamera.y=k;a.secondaryCamera.x=d.x/2-e;a.secondaryCamera.y=d.y/2-k;a.secondaryCamera.sx>a.cameraTarget.zoom&&(a.secondaryCamera.sx-=1*c,a.secondaryCamera.sx<a.cameraTarget.zoom&&
(a.secondaryCamera.sx=a.cameraTarget.zoom));a.secondaryCamera.sx<a.cameraTarget.zoom&&(a.secondaryCamera.sx+=1*c,a.secondaryCamera.sx>a.cameraTarget.zoom&&(a.secondaryCamera.sx=a.cameraTarget.zoom));a.secondaryCamera.sy=a.secondaryCamera.sx;a.primaryCamera.update();a.secondaryCamera.update();a.hudCamera.update()};O=function(c,d,e,k){c=e-c;d=k-d;return Math.sqrt(c*c+d*d)};D=function(c,d){return c.x>=d.x&&c.x<=d.x+d.width&&c.y>=d.y&&c.y<=d.y+d.height};n.jumpToEnd()})})(window.SorobanSnooker=window.SorobanSnooker||
{});document.addEventListener("DOMContentLoaded",function(){window.addEventListener("resize",function(a){SorobanSnooker.resize()});SorobanSnooker.sprites=new Image;SorobanSnooker.sprites.onload=function(){SorobanSnooker.initialize()};SorobanSnooker.sprites.src="sprites.png"});